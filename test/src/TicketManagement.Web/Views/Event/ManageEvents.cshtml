@model IEnumerable<EventViewModel>
@inject IViewLocalizer Localizer
@inject TimeZoneHelper TimeZoneHelper
<link href="~/css/events.css" rel="stylesheet">
<div class="all-container">
    <div class="container">
        <div class="container-item">
            <h1>@Localizer["Events management"]</h1>
        </div>
        <div class="container-item">
            <a asp-controller="Event" asp-action="Create" class="crud-button">@Localizer["Create"]</a>
            <form asp-action="Import" asp-controller="ThirdPartyEvent" method="post" class="file-form" enctype="multipart/form-data" id="file-form">
                <label class="btn btn-default btn-file crud-button">
                    @Localizer["Import"] <input type="file" style="display: none;" required name="jsonFile" class="file-input" accept="application/JSON" id="json-file">
                </label>
            </form>
            <h5 class="text-danger" id="info"></h5>
        </div>
        <div class="container-item">
            @if (@Model?.Count() > 0)
            {
                <table class="table">
                    <thead>
                        <tr>
                            <th>@Localizer["Name"]</th>
                            <th>@Localizer["Start"]</th>
                            <td />
                        </tr>
                    </thead>
                    <tbody>

                        @foreach (var eventItem in @Model)
                        {
                            <tr>
                                <td>@eventItem.Name</td>
                                @{var start = await TimeZoneHelper.ConvertToLocalAsync(eventItem.Start);}
                                <td>@start.ToString("g")</td>
                                <td>
                                    <div class="button-container">
                                        <div><a class="crud-button" asp-controller="Event" asp-action="Details" asp-route-eventId="@eventItem.Id">@Localizer["Details"]</a></div>
                                        <div><a class="crud-button" asp-controller="Event" asp-action="Edit" asp-route-eventId="@eventItem.Id">@Localizer["Edit"]</a></div>
                                        <div><a class="crud-button load-modal-frame" asp-controller="Event" asp-action="Delete" asp-route-eventId="@eventItem.Id">@Localizer["Delete"]</a></div>
                                    </div>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            }
            else
            {
                <h3>@Localizer["There are no events"]</h3>
            }
        </div>
    </div>
</div>
<script src="~/lib/jquery/dist/jquery.min.js"></script>
<div class="modal">
    <span class="modal-close">
        <svg viewBox="0 0 40 40">
            <path class="close-x" d="M 10,10 L 30,30 M 30,10 L 10,30" />
        </svg>
    </span>
    <iframe></iframe>
</div>

<div class="overlay"></div>
<script type="text/javascript">
    $('#json-file').change(function () {
        var formData = new FormData();
        formData.append('file', $("#json-file")[0].files[0]);
            $.ajax({
                type: "POST",
                url: '@Url.Action("Import", "ThirdPartyEvent")',
                contentType: false,
                processData: false,
                data: formData,
                dataType: 'json',
                statusCode: {
                    200: function (response) {
                        location.reload();
                    },
                    400: function (response) {
                        document.getElementById('info').innerHTML = response.responseText;
                    }
                }
            });
    });
</script>